<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>Pulse v4.3.1</title>
<link rel="manifest" href="manifest.webmanifest?v=431">
<meta name="theme-color" content="#0b1520">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<style>
:root{--bg:#0b1520;--card:rgba(18,31,48,.9);--text:#eaf2f8;--muted:#a9c3d6;--line:#183044;--accent:#58b7ff;--sea1:#8fe8ff;--sea2:#28b7e1;--sea3:#0e7aa5}
*{box-sizing:border-box}html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
header{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,21,32,.9),rgba(11,21,32,.65));backdrop-filter:saturate(140%) blur(10px);z-index:10;border-bottom:1px solid var(--line)}
header .row{display:flex;align-items:center;justify-content:space-between;padding:12px 16px}
h1{margin:0;font-size:20px}
.app{padding:16px;max-width:480px;margin:0 auto}
.tabs{display:flex;gap:8px;margin:12px 0}
.tab{flex:1;padding:12px;border-radius:12px;background:var(--card);border:1.5px solid var(--line);text-align:center;font-weight:700}
.tab.active{outline:2px solid var(--accent)}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);margin:12px 0}
.tiny{font-size:12px;color:var(--muted)}.hidden{display:none!important}
.btn{background:var(--accent);color:#06131e;border:none;border-radius:12px;padding:12px 14px;font-weight:800}
.btn.ghost{background:transparent;color:var(--accent);border:1.6px solid var(--accent)}
.pill{padding:10px 14px;border-radius:999px;background:transparent;border:1.6px solid var(--accent);color:var(--accent);font-weight:800}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
input,button,select{font:inherit;color:inherit}.input{border:1.6px solid var(--line);border-radius:10px;padding:10px;width:100%;background:transparent}
/* Dive Mode visuals */
.diveCard{position:relative;border-radius:16px;overflow:hidden;border:1px solid var(--line)}
.diveSea{position:relative;height:360px;background:radial-gradient(80% 60% at 50% 0%,var(--sea1) 0%,var(--sea2) 40%,var(--sea3) 85%);touch-action:none}
.rays{position:absolute;inset:-20% -20% 0 -20%;background:repeating-linear-gradient(115deg,rgba(255,255,255,.18) 0 2px,rgba(255,255,255,0) 2px 28px);mix-blend-mode:overlay;opacity:.35;animation:rays 12s linear infinite}
@keyframes rays{from{transform:translateY(-20px) rotate(0)}to{transform:translateY(20px) rotate(1deg)}}
.depth{position:absolute;left:8px;top:8px;background:rgba(0,0,0,.25);padding:6px 8px;border-radius:10px;border:1px solid rgba(255,255,255,.35);color:#fff;font-weight:700}
.progress{position:absolute;right:8px;top:8px;width:10px;height:320px;border-radius:999px;background:rgba(255,255,255,.18);overflow:hidden;border:1px solid rgba(255,255,255,.35)}
.progress .bar{position:absolute;bottom:0;width:100%;height:0;background:linear-gradient(#58b7ff,#9fe1ff)}
.diver{position:absolute;left:50%;transform:translateX(-50%);width:42px;height:42px;border-radius:10px;background:#55c6ff;border:2px solid #00384f;display:grid;place-items:center;box-shadow:0 6px 18px rgba(0,0,0,.4)}
.diver:after{content:"🤿";font-size:24px}
.fish{position:absolute;width:44px;height:24px;display:grid;place-items:center}
.fish .sprite{font-size:20px;transform-origin:center}
.fish.photographed{background:transparent;border:2px solid #fff;width:54px;height:34px;border-radius:6px;box-shadow:0 0 0 2px rgba(0,0,0,.2) inset}
.bubbles{position:absolute;inset:0;pointer-events:none}
.bubble{position:absolute;bottom:-20px;width:8px;height:8px;background:rgba(255,255,255,.3);border-radius:50%;animation:rise 6s linear infinite}
@keyframes rise{0%{transform:translateY(0) scale(1)}100%{transform:translateY(-400px) scale(1.2)}}
.hud{display:flex;align-items:center;justify-content:space-between;margin:8px 0 4px}
.grid{display:grid;grid-template-columns:1fr;gap:12px}.game{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px}
/* Bubble Burst */
.popsea{position:relative;height:260px;border-radius:12px;background:radial-gradient(80% 60% at 50% 0%,var(--sea1) 0%,var(--sea2) 40%,var(--sea3) 90%);overflow:hidden;border:1px solid #174d67;touch-action:none}
.pop{position:absolute;bottom:-30px;width:22px;height:22px;border-radius:50%;background:rgba(255,255,255,.35);animation:float 7s linear forwards}
@keyframes float{to{transform:translateY(-300px)}}
/* Name 3 Fish */
.photo{width:100%;border-radius:12px;overflow:hidden;border:1px solid var(--line);margin-bottom:8px}
.photo img{display:block;width:100%;height:auto}
.chips{display:flex;gap:10px;flex-wrap:wrap}
.chip{padding:10px 14px;border-radius:999px;background:#14354a;border:1px solid #275b79;cursor:pointer;color:#eaf2f8}
.chip.correct{background:#0f3f2e;border-color:#1b7a56}.chip.wrong{background:#402222;border-color:#7a3131}
/* Hidden Marine Life */
.garden{position:relative;height:260px;border-radius:12px;overflow:hidden;border:1px solid #174d67;background:linear-gradient(#0c3650,#0a2740)}
.coral{position:absolute;border-radius:30px / 20px}
.coral.red{background:#ff6b6b}.coral.orange{background:#ffa94d}.coral.yellow{background:#ffd43b}.coral.pink{background:#ff99c8}.coral.purple{background:#b197fc}.coral.green{background:#69db7c}
.hidefish{position:absolute;width:30px;height:18px;border-radius:14px 14px 14px 4px;background:#ffd166;box-shadow:12px 0 0 -6px #ffd166,-6px 0 0 #ffb703}
.hidefish:after{content:"";position:absolute;left:22px;top:7px;width:6px;height:6px;background:#0f1e2a;border-radius:50%}
footer{color:var(--muted);text-align:center;padding:16px 0}
</style>
</head>
<body>
<header>
  <div class="row">
    <h1>Pulse</h1>
    <div class="row">
      <button id="btn-print" class="btn ghost">Weekly PDF</button>
      <button id="btn-shield" class="btn">Stress Shield</button>
    </div>
  </div>
</header>

<div class="app">
  <div class="tabs">
    <div class="tab active" onclick="show('home')">Home</div>
    <div class="tab" onclick="show('shield')">Stress Shield</div>
  </div>

  <div id="home" class="screen">
    <div class="card">
      <div class="tiny">Welcome back.</div>
      <div class="row" style="margin-top:10px">
        <button class="pill" onclick="show('shield')">Stress Reset</button>
      </div>
    </div>
  </div>

  <div id="shield" class="screen hidden">
    <div class="card diveCard">
      <div class="diveSea" id="dive">
        <div class="rays"></div>
        <div class="depth" id="depth">Depth: 10 m</div>
        <div class="progress"><div class="bar" id="ascBar"></div></div>
        <div class="diver" id="diver" style="top:300px"></div>
        <div class="bubbles" id="bubbles"></div>
        <div id="fishLayer"></div>
      </div>
      <div class="hud">
        <div class="tiny" id="timerLabel">Ready • 10:00</div>
        <div class="tiny">Photos: <span id="photos">0</span></div>
      </div>
      <div class="row" style="margin-bottom:8px">
        <button class="btn" onclick="startDive(600)">Start 10:00</button>
        <button class="btn ghost" onclick="startDive(60)">Demo 1:00</button>
        <button class="btn ghost" onclick="stopDive()">Stop</button>
      </div>
    </div>

    <div class="grid">
      <div class="game">
        <h3>Bubble Burst</h3>
        <div class="row">
          <button class="btn" onclick="startBubbles()">Start</button>
          <button class="btn ghost" onclick="stopBubbles()">Stop</button>
          <div class="tiny">Score: <span id="bubbleScore">0</span></div>
        </div>
        <div class="popsea" id="popsea"></div>
      </div>

      <div class="game">
        <h3>Name 3 Fish</h3>
        <div class="photo"><img id="fishPhoto" alt="Fish photo"></div>
        <div class="tiny">Tap the correct name:</div>
        <div class="chips" id="fishChips"></div>
        <div class="tiny" id="nameStatus">0 / 3</div>
      </div>

      <div class="game">
        <h3>Spot Hidden Marine Life</h3>
        <div class="tiny">Find the hidden fish in the coral garden.</div>
        <div class="garden" id="garden"></div>
        <div class="tiny">Found: <span id="foundCount">0</span> / 5</div>
      </div>
    </div>
  </div>
</div>

<footer>Local-first • v4.3.1</footer>

<script>
function show(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); const idx={home:0,shield:1}[id]; document.querySelectorAll('.tab')[idx].classList.add('active'); }
document.getElementById('btn-print').addEventListener('click', ()=> window.print());
document.getElementById('btn-shield').addEventListener('click', ()=>{ show('shield'); startDive(600); });

let diveInt=null, diveSecs=0, diveTotal=600, photos=0, fishTimer=null;
function startDive(total){
  stopDive(); diveTotal=total; diveSecs=total; photos=0; document.getElementById('photos').textContent=photos;
  const ascBar=document.getElementById('ascBar'); const depthLabel=document.getElementById('depth'); const diver=document.getElementById('diver'); const dive=document.getElementById('dive');
  createFishLoop(); createBubbles();
  diveInt=setInterval(()=>{
    diveSecs--; const pct=1-(diveSecs/diveTotal); const depth=Math.max(0,Math.round((1-pct)*10));
    depthLabel.textContent="Depth: "+depth+" m"; ascBar.style.height=Math.round(pct*320)+"px"; diver.style.top=(300-pct*280)+"px";
    dive.style.background="radial-gradient(80% 60% at 50% 0%, var(--sea1) 0%, var(--sea2) "+Math.round(40+30*pct)+"%, var(--sea3) 85%)";
    document.getElementById('timerLabel').textContent=(Math.floor(diveSecs/60))+":"+(('0'+(diveSecs%60)).slice(-2));
    if(diveSecs<=0){ stopDive(); document.getElementById('timerLabel').textContent="Surface reached ✅"; }
  },1000);
}
function stopDive(){ clearInterval(diveInt); stopFishLoop(); clearBubbles(); }
function createBubbles(){ const cont=document.getElementById('bubbles'); cont.innerHTML=''; for(let i=0;i<12;i++){ const b=document.createElement('div'); b.className='bubble'; b.style.left=Math.round(Math.random()*440)+'px'; b.style.animationDuration=(5+Math.random()*4)+'s'; b.style.animationDelay=(Math.random()*3)+'s'; cont.appendChild(b);} }
function clearBubbles(){ document.getElementById('bubbles').innerHTML=''; }

// Fish movement: face direction and wander
function createFishLoop(){
  const layer=document.getElementById('fishLayer'); const W=480, H=360;
  fishTimer=setInterval(()=>{
    const fish=document.createElement('div'); fish.className='fish';
    const sprite=document.createElement('span'); sprite.className='sprite'; sprite.textContent='🐟'; fish.appendChild(sprite);
    let x=Math.random()<0.5?-50:W+50; let y=40+Math.random()*(H-80);
    let speedX=(x<0? 2+Math.random()*2 : -2-Math.random()*2); let speedY=(Math.random()*2-1)*(1+Math.random()*1.2);
    const rotate=()=> Math.atan2(speedY,speedX)*180/Math.PI;
    const face=()=>{ sprite.style.transform="rotate("+rotate()+"deg)"; };
    const move=()=>{ x+=speedX; y+=speedY; if(y<20||y>H-20) speedY*=-1; if(Math.random()<0.02){ speedY+=(Math.random()-.5)*0.8; } fish.style.left=x+'px'; fish.style.top=y+'px'; face(); if(x<-80||x>W+80){ fish.remove(); cancelAnimationFrame(anim); return;} anim=requestAnimationFrame(move); };
    let anim=requestAnimationFrame(move);
    fish.addEventListener('click',()=>{ if(!fish.classList.contains('photographed')){ fish.classList.add('photographed'); photos++; document.getElementById('photos').textContent=photos; } });
    fish.style.left=x+'px'; fish.style.top=y+'px'; layer.appendChild(fish);
  },1100);
}
function stopFishLoop(){ clearInterval(fishTimer); document.querySelectorAll('.fish').forEach(f=>f.remove()); }

// Bubble Burst: no zoom, full area
let popInt=null, bubbleScore=0;
function startBubbles(){
  stopBubbles(); bubbleScore=0; document.getElementById('bubbleScore').textContent=bubbleScore;
  const sea=document.getElementById('popsea'); sea.addEventListener('touchstart', e=>{ e.preventDefault(); }, {passive:false});
  popInt=setInterval(()=>{ const b=document.createElement('div'); b.className='pop'; b.style.left=Math.round(Math.random()*440)+'px'; b.style.animationDuration=(5+Math.random()*5)+'s';
    const inc=()=>{ bubbleScore++; document.getElementById('bubbleScore').textContent=bubbleScore; b.remove(); };
    b.addEventListener('click', inc); b.addEventListener('touchstart', inc, {passive:true});
    sea.appendChild(b); setTimeout(()=> b.remove(), 11000);
  },550);
}
function stopBubbles(){ clearInterval(popInt); document.getElementById('popsea').innerHTML=''; }

// Name 3 Fish with simple inline SVG photos
const fishPhotos=[
 {name:'Clownfish', url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='120'><rect width='100%' height='100%' rx='12' fill='rgba(255,255,255,0.1)'/><circle cx='90' cy='60' r='36' fill='%23ff7f45'/><rect x='65' y='50' width='50' height='8' fill='white'/><rect x='65' y='68' width='50' height='8' fill='white'/></svg>"},
 {name:'Parrotfish', url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='120'><rect width='100%' height='100%' rx='12' fill='rgba(255,255,255,0.1)'/><ellipse cx='100' cy='60' rx='60' ry='34' fill='%2331c48d'/></svg>"},
 {name:'Butterflyfish', url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='120'><rect width='100%' height='100%' rx='12' fill='rgba(255,255,255,0.1)'/><ellipse cx='100' cy='60' rx='60' ry='34' fill='%23ffe066'/></svg>"},
 {name:'Angelfish', url:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='120'><rect width='100%' height='100%' rx='12' fill='rgba(255,255,255,0.1)'/><ellipse cx='100' cy='60' rx='60' ry='34' fill='%238ec5ff'/></svg>"}
];
let picked=0;
function setupNameChips(){
  const box=document.getElementById('fishChips'); const photo=document.getElementById('fishPhoto');
  const correctFish = fishPhotos[Math.floor(Math.random()*fishPhotos.length)]; photo.src=correctFish.url;
  box.innerHTML=''; picked=0; document.getElementById('nameStatus').textContent='0 / 3';
  const names = fishPhotos.map(f=>f.name).sort(()=>Math.random()-0.5); const correct=new Set([correctFish.name]);
  for(const n of names){ const chip=document.createElement('div'); chip.className='chip'; chip.textContent=n;
    chip.addEventListener('click',()=>{ if(chip.classList.contains('correct')||chip.classList.contains('wrong'))return;
      if(correct.has(n)){ chip.classList.add('correct'); picked++; } else { chip.classList.add('wrong'); }
      document.getElementById('nameStatus').textContent=picked+' / 3';
      if(picked<3 && chip.classList.contains('correct')){ const next=fishPhotos[Math.floor(Math.random()*fishPhotos.length)]; photo.src=next.url; correct.clear(); correct.add(next.name); }
    });
    box.appendChild(chip);
  }
}
setupNameChips();

// Hidden Marine Life — coral garden
function garden(){
  const g=document.getElementById('garden'); g.innerHTML='';
  const corals=[{c:'red',x:20,y:180,w:140,h:70},{c:'orange',x:100,y:200,w:160,h:60},{c:'yellow',x:260,y:190,w:140,h:70},{c:'pink',x:40,y:140,w:90,h:50},{c:'purple',x:200,y:150,w:120,h:50},{c:'green',x:320,y:160,w:120,h:60}];
  corals.forEach(o=>{ const el=document.createElement('div'); el.className='coral '+o.c; el.style.left=o.x+'px'; el.style.top=o.y+'px'; el.style.width=o.w+'px'; el.style.height=o.h+'px'; g.appendChild(el); });
  const hides=[{x:60,y:190},{x:180,y:210},{x:300,y:200},{x:120,y:160},{x:360,y:190}];
  let found=0; document.getElementById('foundCount').textContent=found+' / '+hides.length;
  hides.forEach(h=>{ const f=document.createElement('div'); f.className='hidefish'; f.style.left=h.x+'px'; f.style.top=h.y+'px'; f.style.transform='rotate('+(Math.random()*50-25)+'deg)'; f.addEventListener('click',()=>{ if(!f.classList.contains('found')){ f.classList.add('found'); found++; document.getElementById('foundCount').textContent=found+' / '+hides.length; }}); g.appendChild(f); });
}
garden();
</script>
</body>
</html>
